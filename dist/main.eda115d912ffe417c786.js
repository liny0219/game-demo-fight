"use strict";(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[792],{40:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Entity=void 0,o(227);var n=function(){function t(e){this.components=new Map,this.id=t.nextId++,this.scene=e,console.log("[Entity] 创建新实体 ID: ".concat(this.id))}return t.prototype.addComponent=function(t){var e=t.constructor;return console.log("[Entity ".concat(this.id,"] 添加组件: ").concat(e.name)),this.components.set(e,t),t.entity=this,t},t.prototype.removeComponent=function(t){var e;console.log("[Entity ".concat(this.id,"] 移除组件: ").concat(t.name));var o=this.components.get(t);o?(null===(e=o.destroy)||void 0===e||e.call(o),this.components.delete(t)):console.warn("[Entity ".concat(this.id,"] 尝试移除不存在的组件: ").concat(t.name))},t.prototype.getComponent=function(t){var e=this.components.get(t);if(e)return console.log("[Entity ".concat(this.id,"] 获取组件: ").concat(t.name)),e;console.warn("[Entity ".concat(this.id,"] 尝试获取不存在的组件: ").concat(t.name))},t.prototype.hasComponent=function(t){var e=this.components.has(t);return console.log("[Entity ".concat(this.id,"] 检查组件 ").concat(t.name,": ").concat(e)),e},t.prototype.hasComponents=function(t){var e=this,o=t.every((function(t){return e.hasComponent(t)}));return console.log("[Entity ".concat(this.id,"] 检查多个组件: ").concat(o)),o},t.prototype.getAllComponents=function(){var t=Array.from(this.components.values());return console.log("[Entity ".concat(this.id,"] 获取所有组件: ").concat(t.length," 个")),t},t.prototype.getScene=function(){return this.scene},t.prototype.destroy=function(){var t=this;console.log("[Entity ".concat(this.id,"] 销毁实体")),this.components.forEach((function(e){var o;console.log("[Entity ".concat(t.id,"] 销毁组件: ").concat(e.constructor.name)),null===(o=e.destroy)||void 0===o||o.call(e)})),this.components.clear()},t.nextId=1,t}();e.Entity=n},88:function(t,e,o){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0}),e.VelocityComponent=void 0;var r=function(t){function e(e,o,n,i){void 0===e&&(e=0),void 0===o&&(o=0),void 0===n&&(n=1e3),void 0===i&&(i=0);var r=t.call(this)||this;return r.vx=e,r.vy=o,r.maxSpeed=n,r.friction=i,r}return i(e,t),e.prototype.setVelocity=function(t,e){this.vx=t,this.vy=e,this.limitSpeed()},e.prototype.addVelocity=function(t,e){this.vx+=t,this.vy+=e,this.limitSpeed()},e.prototype.limitSpeed=function(){var t=Math.sqrt(this.vx*this.vx+this.vy*this.vy);t>this.maxSpeed&&(this.vx=this.vx/t*this.maxSpeed,this.vy=this.vy/t*this.maxSpeed)},e.prototype.applyFriction=function(t){if(this.friction>0){var e=this.friction*t/1e3;this.vx*=Math.max(0,1-e),this.vy*=Math.max(0,1-e)}},e.prototype.getSpeed=function(){return Math.sqrt(this.vx*this.vx+this.vy*this.vy)},e}(o(264).Component);e.VelocityComponent=r},111:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.World=void 0,o(227);var n=o(40),i=function(){function t(t){this.entities=new Map,this.systems=[],this.entitiesToRemove=new Set,this.entitiesToAdd=new Set,this.nextEntityId=0,this.scene=t,console.log("[World] 创建 ECS 世界")}return t.prototype.createEntity=function(){var t=this.nextEntityId++,e=new n.Entity(this.scene);return this.entitiesToAdd.add(e),console.log("[World] 创建实体: ".concat(t)),e},t.prototype.removeEntity=function(t){console.log("[World] 移除实体: ".concat(t.id)),this.entitiesToRemove.add(t)},t.prototype.addSystem=function(t){console.log("[World] 添加系统: ".concat(t.constructor.name)),this.systems.push(t),this.systems.sort((function(t,e){return t.getPriority()-e.getPriority()})),t.init&&t.init(),console.log("系统 ".concat(t.getName()," 已添加到世界"))},t.prototype.removeSystem=function(t){console.log("[World] 移除系统: ".concat(t.constructor.name));var e=this.systems.indexOf(t);-1!==e&&this.systems.splice(e,1)},t.prototype.getSystem=function(t){return this.systems.find((function(e){return e instanceof t}))},t.prototype.getEntitiesWith=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var o=[],n=0,i=Array.from(this.entities.values());n<i.length;n++){var r=i[n];r.hasComponents(t)&&o.push(r)}return o},t.prototype.getAllEntities=function(){return Array.from(this.entities.values())},t.prototype.getEntityCount=function(){return this.entities.size},t.prototype.update=function(t){var e=this;console.log("[World] 更新世界，deltaTime: ".concat(t)),this.entitiesToAdd.size>0&&(Array.from(this.entitiesToAdd).forEach((function(t){e.entities.set(t.id,t)})),this.entitiesToAdd.clear()),this.entitiesToRemove.size>0&&(Array.from(this.entitiesToRemove).forEach((function(t){e.entities.delete(t.id),t.destroy()})),this.entitiesToRemove.clear());for(var o=0,n=this.systems;o<n.length;o++){var i=n[o];console.log("[World] 更新系统: ".concat(i.constructor.name)),i.update(t)}},t.prototype.pause=function(){for(var t=0,e=this.systems;t<e.length;t++){var o=e[t];o.pause&&o.pause()}console.log("世界已暂停")},t.prototype.resume=function(){for(var t=0,e=this.systems;t<e.length;t++){var o=e[t];o.resume&&o.resume()}console.log("世界已恢复")},t.prototype.clear=function(){console.log("[World] 销毁世界");for(var t=0,e=Array.from(this.entities.values());t<e.length;t++)e[t].destroy();this.entities.clear(),this.entitiesToAdd.clear(),this.entitiesToRemove.clear();for(var o=0,n=this.systems;o<n.length;o++){var i=n[o];i.destroy&&i.destroy()}this.systems.length=0,console.log("世界已清空")},t.prototype.getStats=function(){return{entityCount:this.entities.size,systemCount:this.systems.length,pendingAdditions:this.entitiesToAdd.size,pendingRemovals:this.entitiesToRemove.size}},t.prototype.getEntities=function(){return Array.from(this.entities.values())},t.prototype.getEntityById=function(t){return this.entities.get(t)},t.prototype.destroy=function(){console.log("[World] 销毁世界"),Array.from(this.entities.values()).forEach((function(t){t.destroy()})),this.entities.clear(),this.systems=[]},t}();e.World=i},159:function(t,e,o){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0}),e.TransformComponent=void 0;var r=function(t){function e(e,o,n,i,r){void 0===e&&(e=0),void 0===o&&(o=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=1);var s=t.call(this)||this;return s.x=e,s.y=o,s.rotation=n,s.scaleX=i,s.scaleY=r,s}return i(e,t),e.prototype.setPosition=function(t,e){this.x=t,this.y=e},e.prototype.getPosition=function(){return{x:this.x,y:this.y}},e.prototype.translate=function(t,e){this.x+=t,this.y+=e},e.prototype.setRotation=function(t){this.rotation=t},e.prototype.rotate=function(t){this.rotation+=t},e.prototype.setScale=function(t,e){this.scaleX=t,this.scaleY=void 0!==e?e:t},e.prototype.distanceTo=function(t){var e=this.x-t.x,o=this.y-t.y;return Math.sqrt(e*e+o*o)},e.prototype.angleTo=function(t){return Math.atan2(t.y-this.y,t.x-this.x)},e.prototype.isInBounds=function(t,e,o,n){return this.x>=t&&this.x<=o&&this.y>=e&&this.y<=n},e.prototype.clone=function(){return new e(this.x,this.y,this.rotation,this.scaleX,this.scaleY)},e.prototype.serialize=function(){return{type:"TransformComponent",x:this.x,y:this.y,rotation:this.rotation,scaleX:this.scaleX,scaleY:this.scaleY}},e.prototype.deserialize=function(t){this.x=t.x||0,this.y=t.y||0,this.rotation=t.rotation||0,this.scaleX=t.scaleX||1,this.scaleY=t.scaleY||1},e.prototype.toString=function(){return"TransformComponent(x: ".concat(this.x.toFixed(2),", y: ").concat(this.y.toFixed(2),", ")+"rotation: ".concat(this.rotation.toFixed(2),", scale: ").concat(this.scaleX.toFixed(2),", ").concat(this.scaleY.toFixed(2),")")},e}(o(264).Component);e.TransformComponent=r},161:function(t,e,o){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0}),e.EnemyVisualSystem=void 0,o(227);var r=o(754),s=o(903),a=o(159),c=o(88),l=o(570),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.MOVEMENT_THRESHOLD=5,e}return i(e,t),e.prototype.update=function(t){for(var e=0,o=this.getEntitiesWith(s.EnemyComponent,a.TransformComponent,c.VelocityComponent,l.SpriteComponent);e<o.length;e++){var n=o[e];this.processEnemyVisuals(n,t)}},e.prototype.processEnemyVisuals=function(t,e){var o=t.getComponent(s.EnemyComponent),n=t.getComponent(c.VelocityComponent),i=t.getComponent(l.SpriteComponent);this.updateMovementState(o,n),this.updateBounceAnimation(o,e),this.applySpriteScale(o,i)},e.prototype.updateMovementState=function(t,e){var o=Math.sqrt(e.vx*e.vx+e.vy*e.vy)>this.MOVEMENT_THRESHOLD;t.setMoving(o)},e.prototype.updateBounceAnimation=function(t,e){t.updateBounceAnimation(e)},e.prototype.applySpriteScale=function(t,e){var o=t.getCurrentScale();e.sprite.setScale(o,o)},e.prototype.setGlobalBounceParameters=function(t,e){for(var o=0,n=this.getEntitiesWith(s.EnemyComponent);o<n.length;o++)n[o].getComponent(s.EnemyComponent).setBounceParameters(t,e)},e.prototype.setGlobalBounceEnabled=function(t){for(var e=0,o=this.getEntitiesWith(s.EnemyComponent);e<o.length;e++)o[e].getComponent(s.EnemyComponent).setBounceEnabled(t)},e.prototype.getSystemStats=function(){for(var t=this.getEntitiesWith(s.EnemyComponent),e=0,o=0,n=0,i=t;n<i.length;n++){var r=i[n].getComponent(s.EnemyComponent);r.isMoving&&e++,r.bounceEnabled&&o++}return{totalEnemies:t.length,movingEnemies:e,bouncingEnemies:o}},e}(r.System);e.EnemyVisualSystem=p},262:function(t,e,o){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.PlayerComponent=void 0;var s=function(t){function e(e,o,n,i){void 0===e&&(e=200),void 0===o&&(o=5e3),void 0===n&&(n=200),void 0===i&&(i=400);var r=t.call(this)||this;return r.skillCooldown=0,r.isAttacking=!1,r.movementSpeed=e,r.skillCooldownTime=o,r.attackDuration=n,r.projectileSpeed=i,r.lastMoveDirection={x:1,y:0},r}return i(e,t),e.prototype.update=function(t){this.skillCooldown>0&&(this.skillCooldown=Math.max(0,this.skillCooldown-t))},e.prototype.useSkill=function(){return!(this.skillCooldown>0||(this.skillCooldown=this.skillCooldownTime,0))},e.prototype.canUseSkill=function(){return this.skillCooldown<=0},e.prototype.getSkillCooldownPercent=function(){return this.skillCooldown/this.skillCooldownTime},e.prototype.getSkillCooldownSeconds=function(){return Math.ceil(this.skillCooldown/1e3)},e.prototype.setMoveDirection=function(t,e){0===t&&0===e||(this.lastMoveDirection.x=t,this.lastMoveDirection.y=e)},e.prototype.getMoveDirection=function(){return{x:this.lastMoveDirection.x,y:this.lastMoveDirection.y}},e.prototype.startAttack=function(){this.isAttacking=!0},e.prototype.endAttack=function(){this.isAttacking=!1},e.prototype.resetSkillCooldown=function(){this.skillCooldown=0},e.prototype.reduceSkillCooldown=function(t){this.skillCooldown=Math.max(0,this.skillCooldown-t)},e.prototype.getMovementSpeed=function(){return this.movementSpeed},e.prototype.setMovementSpeed=function(t){this.movementSpeed=Math.max(0,t)},e.prototype.serialize=function(){return{type:"PlayerComponent",movementSpeed:this.movementSpeed,skillCooldown:this.skillCooldown,skillCooldownTime:this.skillCooldownTime,lastMoveDirection:r({},this.lastMoveDirection),isAttacking:this.isAttacking,attackDuration:this.attackDuration,projectileSpeed:this.projectileSpeed}},e.prototype.deserialize=function(t){this.movementSpeed=t.movementSpeed||200,this.skillCooldown=t.skillCooldown||0,this.skillCooldownTime=t.skillCooldownTime||5e3,this.lastMoveDirection=t.lastMoveDirection||{x:1,y:0},this.isAttacking=t.isAttacking||!1,this.attackDuration=t.attackDuration||200,this.projectileSpeed=t.projectileSpeed||400},e}(o(264).Component);e.PlayerComponent=s},264:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Component=void 0;var o=function(){function t(){console.log("[Component] 创建组件: ".concat(this.constructor.name))}return t.prototype.update=function(t){},t.prototype.destroy=function(){console.log("[Component] 销毁组件: ".concat(this.constructor.name))},t.prototype.clone=function(){return console.log("[Component] 克隆组件: ".concat(this.constructor.name)),this},t.prototype.serialize=function(){return console.log("[Component] 序列化组件: ".concat(this.constructor.name)),{}},t.prototype.deserialize=function(t){console.log("[Component] 反序列化组件: ".concat(this.constructor.name))},t}();e.Component=o},323:(t,e)=>{var o;Object.defineProperty(e,"__esModule",{value:!0}),e.GameState=void 0,function(t){t.MENU="menu",t.PLAYING="playing",t.PAUSED="paused",t.GAME_OVER="game_over"}(o||(e.GameState=o={}))},348:function(t,e,o){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0}),e.ProjectileSystem=void 0,o(227);var r=o(754),s=o(707),a=o(159),c=o(570),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.PROJECTILE_BOUNDS={minX:0,maxX:800,minY:0,maxY:600},e}return i(e,t),e.prototype.update=function(t){for(var e=0,o=this.getEntitiesWith(s.ProjectileComponent,a.TransformComponent,c.SpriteComponent);e<o.length;e++){var n=o[e],i=n.getComponent(s.ProjectileComponent),r=n.getComponent(a.TransformComponent);i.update(t);var l=r.x<this.PROJECTILE_BOUNDS.minX||r.x>this.PROJECTILE_BOUNDS.maxX||r.y<this.PROJECTILE_BOUNDS.minY||r.y>this.PROJECTILE_BOUNDS.maxY;(i.isExpired()||l)&&this.world.removeEntity(n)}},e}(r.System);e.ProjectileSystem=l},363:function(t,e,o){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0}),e.ComponentUpdateSystem=void 0;var r=o(754),s=o(531),a=o(262),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.update=function(t){for(var e,o,n=0,i=this.getEntitiesWith(s.HealthComponent);n<i.length;n++){var r=i[n].getComponent(s.HealthComponent);null===(e=r.update)||void 0===e||e.call(r,t)}for(var c=0,l=this.getEntitiesWith(a.PlayerComponent);c<l.length;c++){var p=l[c].getComponent(a.PlayerComponent);null===(o=p.update)||void 0===o||o.call(p,t)}},e}(r.System);e.ComponentUpdateSystem=c},399:function(t,e,o){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0}),e.EnemyAISystem=void 0,o(227);var r=o(754),s=o(903),a=o(159),c=o(88),l=o(262),p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.update=function(t){var e=this.getEntitiesWith(s.EnemyComponent,a.TransformComponent,c.VelocityComponent),o=this.getEntitiesWith(l.PlayerComponent,a.TransformComponent);if(0!==o.length)for(var n=o[0].getComponent(a.TransformComponent),i=0,r=e;i<r.length;i++){var p=r[i],h=p.getComponent(s.EnemyComponent),u=p.getComponent(a.TransformComponent),y=p.getComponent(c.VelocityComponent);if(!h.isKnockbackActive){var m=Phaser.Math.Angle.Between(u.x,u.y,n.x,n.y);y.setVelocity(Math.cos(m)*h.movementSpeed,Math.sin(m)*h.movementSpeed)}}},e}(r.System);e.EnemyAISystem=p},526:function(t,e,o){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0}),e.HealthBarComponent=void 0,o(227);var r=function(t){function e(e,o,n,i,r){void 0===o&&(o=50),void 0===n&&(n=6),void 0===i&&(i=-25),void 0===r&&(r=100);var s=t.call(this)||this;return s.scene=e,s.width=o,s.height=n,s.yOffset=i,s.maxHealthPerBar=r,s}return i(e,t),e.prototype.createHealthBar=function(t,e){this.destroyHealthBar();var o=t-this.width/2,n=e+this.yOffset;this.background=this.scene.add.rectangle(o,n,this.width,this.height,3355443).setDepth(10).setAlpha(.8).setOrigin(0,.5),this.trail=this.scene.add.rectangle(o,n,this.width,this.height,0).setDepth(11).setOrigin(0,.5),this.bar=this.scene.add.rectangle(o,n,this.width,this.height,16711680).setDepth(12).setOrigin(0,.5),this.multiplierText=this.scene.add.text(o+this.width+5,n,"",{fontSize:"8px",color:"#ffffff"}).setOrigin(0,.5).setDepth(13)},e.prototype.updateHealthBar=function(t,e,o,n){if(this.bar&&this.background&&this.trail){var i=t-this.width/2,r=e+this.yOffset,s=o%this.maxHealthPerBar;0===s&&o>0?s=this.maxHealthPerBar:0===o&&(s=0);var a=s/this.maxHealthPerBar*this.width;if(this.background.setPosition(i,r),this.trail.setPosition(i,r),this.bar.setPosition(i,r),this.bar.setSize(a,this.height),this.trail.setSize(a,this.height),o>this.maxHealthPerBar?(this.bar.setFillStyle(65280),this.trail.setFillStyle(9498256,0)):(this.bar.setFillStyle(16711680),this.trail.setFillStyle(16711680,0)),this.multiplierText){var c=Math.ceil(o/this.maxHealthPerBar);c>1?(this.multiplierText.setText("x".concat(c)),this.multiplierText.setPosition(i+this.width+5,r),this.multiplierText.setVisible(!0)):this.multiplierText.setVisible(!1)}}},e.prototype.destroyHealthBar=function(){this.background&&(this.background.destroy(),this.background=void 0),this.bar&&(this.bar.destroy(),this.bar=void 0),this.trail&&(this.trail.destroy(),this.trail=void 0),this.multiplierText&&(this.multiplierText.destroy(),this.multiplierText=void 0)},e.prototype.destroy=function(){this.destroyHealthBar()},e}(o(264).Component);e.HealthBarComponent=r},529:function(t,e,o){var n=this&&this.__createBinding||(Object.create?function(t,e,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(e,o);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[o]}}),Object.defineProperty(t,n,i)}:function(t,e,o,n){void 0===n&&(n=o),t[n]=e[o]}),i=this&&this.__exportStar||function(t,e){for(var o in t)"default"===o||Object.prototype.hasOwnProperty.call(e,o)||n(e,t,o)},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.gameConfig=e.GameOverScene=e.MainScene=e.EntityFactory=e.ComponentUpdateSystem=e.CollisionSystem=e.HealthBarSystem=e.EnemyAISystem=e.PlayerInputSystem=e.MovementSystem=e.EnemyComponent=e.PlayerComponent=e.HealthBarComponent=e.HealthComponent=e.VelocityComponent=e.SpriteComponent=e.TransformComponent=e.World=e.System=e.Component=e.Entity=void 0;var s=o(40);Object.defineProperty(e,"Entity",{enumerable:!0,get:function(){return s.Entity}});var a=o(264);Object.defineProperty(e,"Component",{enumerable:!0,get:function(){return a.Component}});var c=o(754);Object.defineProperty(e,"System",{enumerable:!0,get:function(){return c.System}});var l=o(111);Object.defineProperty(e,"World",{enumerable:!0,get:function(){return l.World}});var p=o(159);Object.defineProperty(e,"TransformComponent",{enumerable:!0,get:function(){return p.TransformComponent}});var h=o(570);Object.defineProperty(e,"SpriteComponent",{enumerable:!0,get:function(){return h.SpriteComponent}});var u=o(88);Object.defineProperty(e,"VelocityComponent",{enumerable:!0,get:function(){return u.VelocityComponent}});var y=o(531);Object.defineProperty(e,"HealthComponent",{enumerable:!0,get:function(){return y.HealthComponent}});var m=o(526);Object.defineProperty(e,"HealthBarComponent",{enumerable:!0,get:function(){return m.HealthBarComponent}});var f=o(262);Object.defineProperty(e,"PlayerComponent",{enumerable:!0,get:function(){return f.PlayerComponent}});var d=o(903);Object.defineProperty(e,"EnemyComponent",{enumerable:!0,get:function(){return d.EnemyComponent}});var v=o(966);Object.defineProperty(e,"MovementSystem",{enumerable:!0,get:function(){return v.MovementSystem}});var C=o(626);Object.defineProperty(e,"PlayerInputSystem",{enumerable:!0,get:function(){return C.PlayerInputSystem}});var g=o(399);Object.defineProperty(e,"EnemyAISystem",{enumerable:!0,get:function(){return g.EnemyAISystem}});var S=o(870);Object.defineProperty(e,"HealthBarSystem",{enumerable:!0,get:function(){return S.HealthBarSystem}});var _=o(729);Object.defineProperty(e,"CollisionSystem",{enumerable:!0,get:function(){return _.CollisionSystem}});var w=o(363);Object.defineProperty(e,"ComponentUpdateSystem",{enumerable:!0,get:function(){return w.ComponentUpdateSystem}});var b=o(655);Object.defineProperty(e,"EntityFactory",{enumerable:!0,get:function(){return b.EntityFactory}});var x=o(636);Object.defineProperty(e,"MainScene",{enumerable:!0,get:function(){return x.MainScene}});var P=o(919);Object.defineProperty(e,"GameOverScene",{enumerable:!0,get:function(){return P.GameOverScene}});var O=o(774);Object.defineProperty(e,"gameConfig",{enumerable:!0,get:function(){return r(O).default}}),i(o(323),e),o(863)},531:function(t,e,o){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0}),e.HealthComponent=void 0;var r=function(t){function e(e){var o=t.call(this)||this;return o.isInvincible=!1,o.invincibleTime=0,o.isDead=!1,o.maxHealth=e,o.currentHealth=e,o}return i(e,t),e.prototype.takeDamage=function(t,e){return void 0===e&&(e=!1),!(!e&&(this.isInvincible||this.isDead)||this.isDead||(this.currentHealth=Math.max(0,this.currentHealth-t),this.currentHealth<=0&&(this.isDead=!0),0))},e.prototype.heal=function(t){this.isDead||(this.currentHealth=Math.min(this.maxHealth,this.currentHealth+t))},e.prototype.setInvincible=function(t){this.isInvincible=!0,this.invincibleTime=t},e.prototype.update=function(t){this.isInvincible&&this.invincibleTime>0&&(this.invincibleTime-=t,this.invincibleTime<=0&&(this.isInvincible=!1,this.invincibleTime=0,console.log("无敌时间结束")))},e.prototype.getHealthPercentage=function(){return this.currentHealth/this.maxHealth},e.prototype.isAlive=function(){return!this.isDead},e}(o(264).Component);e.HealthComponent=r},570:function(t,e,o){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0}),e.SpriteComponent=void 0,o(227);var r=function(t){function e(e,o,n,i){var r=t.call(this)||this;return r._sprite=null,r.visible=!0,r.alpha=1,console.log("[SpriteComponent] 开始创建精灵: ".concat(i," at (").concat(o,", ").concat(n,")")),r.textureKey=i,r.initializeSprite(e,o,n),r}return i(e,t),e.prototype.initializeSprite=function(t,e,o){try{if(console.log("[SpriteComponent] 检查贴图是否存在: ".concat(this.textureKey)),!t.textures.exists(this.textureKey))return void console.warn("[SpriteComponent] 贴图不存在: ".concat(this.textureKey));if(console.log("[SpriteComponent] 创建物理精灵: ".concat(this.textureKey)),this._sprite=t.physics.add.sprite(e,o,this.textureKey),!this._sprite)return void console.error("[SpriteComponent] 精灵创建失败");console.log("[SpriteComponent] 设置精灵属性"),this._sprite.setCollideWorldBounds(!0),this._sprite.setSize(32,32),this._sprite.setDisplaySize(32,32),console.log("[SpriteComponent] 精灵初始化完成")}catch(t){console.error("[SpriteComponent] 精灵初始化错误:",t)}},Object.defineProperty(e.prototype,"sprite",{get:function(){if(!this._sprite)throw console.error("[SpriteComponent] 尝试访问未初始化的精灵"),new Error("Sprite not initialized");return this._sprite},enumerable:!1,configurable:!0}),e.prototype.setVisible=function(t){console.log("[SpriteComponent] 设置可见性: ".concat(t)),this.visible=t,this._sprite?this._sprite.setVisible(t):console.warn("[SpriteComponent] 无法设置可见性: 精灵未初始化")},e.prototype.setAlpha=function(t){console.log("[SpriteComponent] 设置透明度: ".concat(t)),this.alpha=t,this._sprite?this._sprite.setAlpha(t):console.warn("[SpriteComponent] 无法设置透明度: 精灵未初始化")},e.prototype.setSize=function(t,e){if(console.log("[SpriteComponent] 设置大小: ".concat(t,"x").concat(e)),this._sprite)try{this._sprite.setSize(t,e),this._sprite.setDisplaySize(t,e),console.log("[SpriteComponent] 大小设置成功")}catch(t){console.error("[SpriteComponent] 设置大小失败:",t)}else console.warn("[SpriteComponent] 无法设置大小: 精灵未初始化")},e.prototype.setDepth=function(t){console.log("[SpriteComponent] 设置深度: ".concat(t)),this._sprite?this._sprite.setDepth(t):console.warn("[SpriteComponent] 无法设置深度: 精灵未初始化")},e.prototype.destroy=function(){console.log("[SpriteComponent] 销毁精灵"),this._sprite?(this._sprite.destroy(),this._sprite=null,console.log("[SpriteComponent] 精灵已销毁")):console.warn("[SpriteComponent] 尝试销毁未初始化的精灵")},e}(o(264).Component);e.SpriteComponent=r},626:function(t,e,o){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0}),e.PlayerInputSystem=void 0,o(227);var r=o(754),s=o(262),a=o(88),c=o(159),l=function(t){function e(e,o){var n=t.call(this,e)||this;return n.touchStartTime=0,n.touchStartPosition=null,n.setupControls(o),n}return i(e,t),e.prototype.setupControls=function(t){var e,o,n,i=this;this.cursors=null===(e=t.input.keyboard)||void 0===e?void 0:e.createCursorKeys(),t.input.on("pointerdown",(function(e){i.touchStartTime=t.time.now,i.touchStartPosition={x:e.x,y:e.y},i.handleAttack(e,t)})),t.input.on("pointerup",(function(e){var o=t.time.now-i.touchStartTime;if(i.touchStartPosition){var n=Phaser.Math.Distance.Between(i.touchStartPosition.x,i.touchStartPosition.y,e.x,e.y);o>500&&n<10&&i.handleSkill()}i.touchStartPosition=null,i.stopMovement()})),t.input.on("pointermove",(function(t){t.isDown&&i.touchStartPosition&&i.handleTouchMovement(t)})),null===(o=t.input.keyboard)||void 0===o||o.on("keydown-SPACE",(function(){return i.handleAttack(null,t)})),null===(n=t.input.keyboard)||void 0===n||n.on("keydown-SHIFT",(function(){return i.handleSkill()}))},e.prototype.update=function(t){for(var e=0,o=this.getEntitiesWith(s.PlayerComponent,a.VelocityComponent,c.TransformComponent);e<o.length;e++){var n=o[e],i=n.getComponent(s.PlayerComponent),r=n.getComponent(a.VelocityComponent);this.handleKeyboardMovement(i,r)}},e.prototype.handleKeyboardMovement=function(t,e){if(this.cursors){var o=(this.cursors.left.isDown?-1:0)+(this.cursors.right.isDown?1:0),n=(this.cursors.up.isDown?-1:0)+(this.cursors.down.isDown?1:0);if(0!==o||0!==n){t.lastMoveDirection={x:o,y:n};var i=Math.sqrt(o*o+n*n);e.setVelocity(o/i*t.movementSpeed,n/i*t.movementSpeed)}else this.touchStartPosition||e.setVelocity(0,0)}},e.prototype.handleTouchMovement=function(t){if(this.touchStartPosition)for(var e=0,o=this.getEntitiesWith(s.PlayerComponent,a.VelocityComponent,c.TransformComponent);e<o.length;e++){var n=o[e],i=n.getComponent(s.PlayerComponent),r=n.getComponent(a.VelocityComponent),l=n.getComponent(c.TransformComponent);if(Phaser.Math.Distance.Between(this.touchStartPosition.x,this.touchStartPosition.y,t.x,t.y)>10){var p=Phaser.Math.Angle.Between(l.x,l.y,t.x,t.y),h=Math.cos(p),u=Math.sin(p);i.lastMoveDirection={x:h,y:u},r.setVelocity(h*i.movementSpeed,u*i.movementSpeed)}}},e.prototype.handleAttack=function(t,e){for(var o=0,n=this.getEntitiesWith(s.PlayerComponent,c.TransformComponent);o<n.length;o++){var i=n[o],r=i.getComponent(s.PlayerComponent),a=i.getComponent(c.TransformComponent);if(t){var l=Phaser.Math.Angle.Between(a.x,a.y,t.x,t.y);r.lastMoveDirection={x:Math.cos(l),y:Math.sin(l)}}e.events.emit("player-attack",i)}},e.prototype.handleSkill=function(){for(var t=0,e=this.getEntitiesWith(s.PlayerComponent);t<e.length;t++){var o=e[t];o.getComponent(s.PlayerComponent).useSkill()&&o.getScene().events.emit("player-skill",o)}},e.prototype.stopMovement=function(){for(var t=0,e=this.getEntitiesWith(s.PlayerComponent,a.VelocityComponent);t<e.length;t++)e[t].getComponent(a.VelocityComponent).setVelocity(0,0)},e}(r.System);e.PlayerInputSystem=l},636:function(t,e,o){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0}),e.MainScene=void 0,o(227);var r=o(111),s=o(966),a=o(626),c=o(399),l=o(161),p=o(870),h=o(729),u=o(363),y=o(348),m=o(655),f=o(262),d=o(531),v=o(159),C=function(t){function e(){var e=t.call(this,{key:"MainScene"})||this;return e.enemies=[],e.isGameOver=!1,e.currentWave=1,e.score=0,e.isWaveTransition=!1,e}return i(e,t),e.prototype.init=function(){this.isGameOver=!1,this.currentWave=1,this.score=0,this.enemies=[],this.isWaveTransition=!1},e.prototype.preload=function(){this.createDefaultAssets()},e.prototype.create=function(){var t=this;this.physics.world.setBounds(0,0,this.cameras.main.width,this.cameras.main.height),this.physics.world?(this.world=new r.World(this),this.entityFactory=new m.EntityFactory(this.world,this),this.world.addSystem(new u.ComponentUpdateSystem(this.world)),this.world.addSystem(new s.MovementSystem(this.world)),this.world.addSystem(new a.PlayerInputSystem(this.world,this)),this.world.addSystem(new c.EnemyAISystem(this.world)),this.world.addSystem(new l.EnemyVisualSystem(this.world)),this.collisionSystem=new h.CollisionSystem(this.world,this),this.world.addSystem(this.collisionSystem),this.world.addSystem(new p.HealthBarSystem(this.world)),this.world.addSystem(new y.ProjectileSystem(this.world)),this.time.delayedCall(0,(function(){t.player=t.entityFactory.createPlayer(t.cameras.main.centerX,t.cameras.main.centerY),t.createUI(),t.setupEventListeners(),t.startWave(),t.showWaveStartMessage(),console.log("ECS 主场景创建完成")}))):console.error("Physics system not initialized")},e.prototype.update=function(t,e){this.isGameOver||(this.world.update(e),this.checkWaveStatus(),this.updateUI())},e.prototype.createDefaultAssets=function(){this.textures.exists("player")||this.add.graphics().fillStyle(65280).fillRect(0,0,32,32).generateTexture("player",32,32).destroy(),this.textures.exists("enemy")||this.add.graphics().fillStyle(16711680).fillRect(0,0,32,32).generateTexture("enemy",32,32).destroy(),this.textures.exists("projectile")||this.add.graphics().fillStyle(16776960).fillCircle(4,4,4).generateTexture("projectile",8,8).destroy()},e.prototype.createUI=function(){this.scoreText=this.add.text(10,10,"得分: 0",{fontSize:"24px",color:"#ffffff"}).setDepth(100),this.waveText=this.add.text(10,40,"波数: 1",{fontSize:"20px",color:"#ffffff"}).setDepth(100),this.skillCooldownText=this.add.text(10,70,"",{fontSize:"16px",color:"#ffffff"}).setDepth(100)},e.prototype.setupEventListeners=function(){var t=this;this.events.on("player-attack",(function(e){t.handlePlayerAttack(e)})),this.events.on("player-skill",(function(e){t.handlePlayerSkill(e)})),this.events.on("enemy-death",(function(e){t.handleEnemyDeath(e)})),this.events.on("player-death",(function(e){t.gameOver()}))},e.prototype.handlePlayerAttack=function(t){var e=t.getComponent(f.PlayerComponent),o=t.getComponent(v.TransformComponent),n=o.x+20*e.lastMoveDirection.x,i=o.y+20*e.lastMoveDirection.y;this.entityFactory.createAttackBox(n,i);for(var r=0,s=this.collisionSystem.checkAttackCollisions(n,i,50,50);r<s.length;r++){var a=s[r],c=a.getComponent(d.HealthComponent);c&&!c.isAlive()&&this.handleEnemyDeath(a)}},e.prototype.handlePlayerSkill=function(t){for(var e=t.getComponent(f.PlayerComponent),o=t.getComponent(v.TransformComponent),n=0,i=[{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1},{x:.707,y:.707},{x:-.707,y:.707},{x:.707,y:-.707},{x:-.707,y:-.707}];n<i.length;n++){var r=i[n];this.entityFactory.createProjectile(o.x,o.y,r.x*e.projectileSpeed,r.y*e.projectileSpeed)}},e.prototype.handleEnemyDeath=function(t){var e=this.enemies.indexOf(t);if(-1!==e){if(this.enemies.splice(e,1),t.getComponent(v.TransformComponent)){var o=this.currentWave,n=1+.2*Math.log(o),i=Math.ceil(100*n);this.addScore(i),console.log("敌人死亡，获得 ".concat(i," 分"))}this.world.removeEntity(t)}},e.prototype.startWave=function(){for(var t=Math.min(3+this.currentWave,10),e=0;e<t;e++){var o=void 0,n=void 0;switch(Math.floor(4*Math.random())){case 0:o=Math.random()*this.cameras.main.width,n=-50;break;case 1:o=this.cameras.main.width+50,n=Math.random()*this.cameras.main.height;break;case 2:o=Math.random()*this.cameras.main.width,n=this.cameras.main.height+50;break;default:o=-50,n=Math.random()*this.cameras.main.height}var i=100+50*this.currentWave,r=this.entityFactory.createEnemy(o,n,i);this.enemies.push(r)}this.isWaveTransition=!1,this.currentWave>1&&this.showWaveStartMessage(),console.log("第 ".concat(this.currentWave," 波开始，敌人数量: ").concat(t))},e.prototype.showWaveCompleteMessage=function(){var t=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,"第 ".concat(this.currentWave-1," 波完成！\n\n准备第 ").concat(this.currentWave," 波..."),{fontSize:"32px",color:"#00ff00",fontStyle:"bold",align:"center"}).setOrigin(.5).setDepth(200);this.time.delayedCall(2e3,(function(){t.destroy()}))},e.prototype.showWaveStartMessage=function(){var t=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,"第 ".concat(this.currentWave," 波开始！"),{fontSize:"32px",color:"#ffff00",fontStyle:"bold",align:"center"}).setOrigin(.5).setDepth(200);this.time.delayedCall(2e3,(function(){t.destroy()}))},e.prototype.checkWaveStatus=function(){var t=this;0!==this.enemies.length||this.isWaveTransition||(this.isWaveTransition=!0,this.currentWave++,this.showWaveCompleteMessage(),this.time.delayedCall(2e3,(function(){t.startWave()})))},e.prototype.addScore=function(t){this.score+=t},e.prototype.updateUI=function(){this.scoreText.setText("得分: ".concat(this.score)),this.waveText.setText("波数: ".concat(this.currentWave));var t=this.player.getComponent(f.PlayerComponent);if(t){var e=Math.ceil(t.skillCooldown/1e3);e>0?this.skillCooldownText.setText("技能冷却: ".concat(e,"s")):this.skillCooldownText.setText("技能就绪")}},e.prototype.gameOver=function(){this.isGameOver=!0,console.log("游戏结束！得分: ".concat(this.score,", 波数: ").concat(this.currentWave)),this.scene.start("GameOverScene",{score:this.score,wave:this.currentWave})},e.prototype.shutdown=function(){this.world.clear(),this.events.off("player-attack"),this.events.off("player-skill"),this.events.off("enemy-attack")},e}(Phaser.Scene);e.MainScene=C},655:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EntityFactory=void 0,o(227);var n=o(159),i=o(570),r=o(88),s=o(531),a=o(526),c=o(262),l=o(903),p=o(707),h=function(){function t(t,e){this.world=t,this.scene=e}return t.prototype.createPlayer=function(t,e){console.log("[EntityFactory] 开始创建玩家实体 at (".concat(t,", ").concat(e,")"));var o=this.world.createEntity();console.log("[EntityFactory] 添加 TransformComponent"),o.addComponent(new n.TransformComponent(t,e)),console.log("[EntityFactory] 创建 SpriteComponent");var l=new i.SpriteComponent(this.scene,t,e,"player");return console.log("[EntityFactory] 添加 SpriteComponent"),o.addComponent(l),console.log("[EntityFactory] 添加 VelocityComponent"),o.addComponent(new r.VelocityComponent(0,0,200)),console.log("[EntityFactory] 添加 HealthComponent"),o.addComponent(new s.HealthComponent(100)),console.log("[EntityFactory] 添加 HealthBarComponent"),o.addComponent(new a.HealthBarComponent(this.scene,50,6,-25,100)),console.log("[EntityFactory] 添加 PlayerComponent"),o.addComponent(new c.PlayerComponent),console.log("[EntityFactory] 玩家实体创建完成"),o},t.prototype.createEnemy=function(t,e,o){void 0===o&&(o=200);var c=this.world.createEntity();c.addComponent(new n.TransformComponent(t,e));var p=new i.SpriteComponent(this.scene,t,e,"enemy");c.addComponent(p),c.addComponent(new r.VelocityComponent(0,0,100));var h=new s.HealthComponent(o);return h.isInvincible=!1,h.invincibleTime=0,c.addComponent(h),c.addComponent(new a.HealthBarComponent(this.scene,32,4,-20,100)),c.addComponent(new l.EnemyComponent),c},t.prototype.createProjectile=function(t,e,o,s){var a=this.world.createEntity();a.addComponent(new n.TransformComponent(t,e));var c=new i.SpriteComponent(this.scene,t,e,"projectile");return a.addComponent(c),a.addComponent(new r.VelocityComponent(o,s,400)),a.addComponent(new p.ProjectileComponent(30,3e3)),c.setDepth(1),a},t.prototype.createAttackBox=function(t,e,o,i){var r=this;void 0===o&&(o=50),void 0===i&&(i=50);var s=this.world.createEntity();s.addComponent(new n.TransformComponent(t,e));var a=this.scene.add.rectangle(t,e,o,i,16711680,.3);return a.setDepth(2),this.scene.time.delayedCall(200,(function(){a.destroy(),r.world.removeEntity(s)})),s},t}();e.EntityFactory=h},707:function(t,e,o){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0}),e.ProjectileComponent=void 0;var r=function(t){function e(e,o){void 0===e&&(e=30),void 0===o&&(o=3e3);var n=t.call(this)||this;return n.damage=e,n.lifetime=0,n.maxLifetime=o,n}return i(e,t),e.prototype.update=function(t){this.lifetime+=t},e.prototype.isExpired=function(){return this.lifetime>=this.maxLifetime},e}(o(264).Component);e.ProjectileComponent=r},729:function(t,e,o){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0}),e.CollisionSystem=void 0,o(227);var r=o(754),s=o(159),a=o(570),c=o(531),l=o(262),p=o(903),h=o(88),u=o(707),y=function(t){function e(e,o){var n=t.call(this,e)||this;return n.scene=o,n}return i(e,t),e.prototype.update=function(t){this.checkPlayerEnemyCollisions(),this.checkProjectileEnemyCollisions()},e.prototype.checkPlayerEnemyCollisions=function(){var t=this.getEntitiesWith(l.PlayerComponent,s.TransformComponent,c.HealthComponent,a.SpriteComponent),e=this.getEntitiesWith(p.EnemyComponent,s.TransformComponent,a.SpriteComponent);if(0!==t.length)for(var o=t[0],n=o.getComponent(s.TransformComponent),i=o.getComponent(c.HealthComponent),r=o.getComponent(a.SpriteComponent),h=0,u=e;h<u.length;h++){var y=u[h],m=y.getComponent(s.TransformComponent),f=y.getComponent(p.EnemyComponent);y.getComponent(a.SpriteComponent),Phaser.Math.Distance.Between(n.x,n.y,m.x,m.y)<30&&i.takeDamage(f.damage)&&(i.setInvincible(1e3),this.createPlayerDamageEffect(r.sprite),this.createScreenShake(),this.applyKnockback(o,m.x,m.y,100),console.log("玩家受到 ".concat(f.damage," 点伤害，剩余血量: ").concat(i.currentHealth)),i.isAlive()||this.scene.events.emit("player-death",o))}},e.prototype.checkProjectileEnemyCollisions=function(){for(var t=this.getEntitiesWith(u.ProjectileComponent,s.TransformComponent,a.SpriteComponent),e=this.getEntitiesWith(p.EnemyComponent,s.TransformComponent,c.HealthComponent,a.SpriteComponent),o=[],n=0,i=t;n<i.length;n++){var r=(w=i[n]).getComponent(s.TransformComponent),l=w.getComponent(u.ProjectileComponent),h=w.getComponent(a.SpriteComponent);if(r&&l&&h){for(var y=!1,m=0,f=e;m<f.length;m++){var d=f[m],v=d.getComponent(s.TransformComponent),C=d.getComponent(c.HealthComponent),g=d.getComponent(a.SpriteComponent);if(v&&C&&g&&Phaser.Math.Distance.Between(r.x,r.y,v.x,v.y)<20){C.takeDamage(l.damage,!0),this.applyEnemyKnockback(d,r.x,r.y,150),this.createEnemyDamageEffect(g.sprite),this.createProjectileHitEffect(r.x,r.y),console.log("投射物击中敌人，造成 ".concat(l.damage," 点伤害，敌人剩余血量: ").concat(C.currentHealth)),o.push(w),y=!0,C.isAlive()||this.scene.events.emit("enemy-death",d);break}}if(y)break}}for(var S=0,_=o;S<_.length;S++){var w=_[S];this.world.removeEntity(w)}},e.prototype.createPlayerDamageEffect=function(t){var e=this.scene.add.circle(t.x,t.y,25,65535,.3);e.setDepth(t.depth-1),this.scene.tweens.add({targets:e,scaleX:1.3,scaleY:1.3,alpha:.6,duration:300,yoyo:!0,repeat:2,ease:"Sine.easeInOut"});var o=this.scene.add.circle(t.x,t.y,28,8978431,0);o.setDepth(t.depth-2),o.setStrokeStyle(3,65535,.8),this.scene.tweens.add({targets:o,scaleX:1.5,scaleY:1.5,alpha:.4,duration:200,yoyo:!0,repeat:4,ease:"Power2"});var n=this.scene.time.addEvent({delay:16,repeat:62,callback:function(){e.active&&e.setPosition(t.x,t.y),o.active&&o.setPosition(t.x,t.y)}});this.scene.time.delayedCall(1e3,(function(){e.active&&e.destroy(),o.active&&o.destroy(),n.destroy()})),t.setTint(16737894),this.scene.time.delayedCall(200,(function(){t.clearTint()})),this.scene.tweens.add({targets:t,scaleX:1.1,scaleY:1.1,duration:100,yoyo:!0,repeat:1})},e.prototype.createEnemyDamageEffect=function(t){var e=[16711680,16737792,16724736],o=0,n=this.scene.time.addEvent({delay:40,repeat:6,callback:function(){t.setTint(e[o%e.length]),o++}});this.scene.tweens.add({targets:t,alpha:.7,duration:50,yoyo:!0,repeat:3,onComplete:function(){t.setAlpha(1),t.clearTint(),n.destroy()}})},e.prototype.createScreenShake=function(){var t=this,e=this.scene.cameras.main;e.shake(200,.03),this.scene.time.delayedCall(150,(function(){e.shake(150,.015)})),this.scene.time.timeScale=.5,this.scene.time.delayedCall(120,(function(){t.scene.time.timeScale=.8})),this.scene.time.delayedCall(200,(function(){t.scene.time.timeScale=1}));var o=this.scene.add.rectangle(e.centerX,e.centerY,e.width,e.height,16711680,.3).setDepth(999).setScrollFactor(0);this.scene.tweens.add({targets:o,alpha:0,duration:200,onComplete:function(){o.destroy()}})},e.prototype.applyKnockback=function(t,e,o,n){var i=t.getComponent(s.TransformComponent),r=t.getComponent(h.VelocityComponent);if(i&&r){var a=Phaser.Math.Angle.Between(e,o,i.x,i.y),c=Math.cos(a)*n,l=Math.sin(a)*n;r.setVelocity(c,l),this.scene.time.delayedCall(300,(function(){r.setVelocity(.5*r.vx,.5*r.vy)}))}},e.prototype.checkAttackCollisions=function(t,e,o,n){for(var i=[],r=0,l=this.getEntitiesWith(p.EnemyComponent,s.TransformComponent,c.HealthComponent);r<l.length;r++){var h=l[r],u=h.getComponent(s.TransformComponent),y=h.getComponent(c.HealthComponent);if(Phaser.Math.Distance.Between(t,e,u.x,u.y)<=o){y.takeDamage(n,!0),this.applyEnemyKnockback(h,t,e,200);var m=h.getComponent(a.SpriteComponent);m&&this.createEnemyDamageEffect(m.sprite),i.push(h),console.log("敌人受到 ".concat(n," 点伤害，剩余血量: ").concat(y.currentHealth)),y.isAlive()||this.scene.events.emit("enemy-death",h)}}return i},e.prototype.applyEnemyKnockback=function(t,e,o,n){var i=t.getComponent(s.TransformComponent),r=t.getComponent(h.VelocityComponent),a=t.getComponent(p.EnemyComponent);if(i&&r&&a){var c=Phaser.Math.Angle.Between(e,o,i.x,i.y),l=Math.cos(c)*n,u=Math.sin(c)*n;r.setVelocity(l,u),a.setKnockback(!0),this.scene.time.delayedCall(500,(function(){a.setKnockback(!1),r.setVelocity(.3*r.vx,.3*r.vy)}))}},e.prototype.createProjectileHitEffect=function(t,e){var o=this.scene.add.circle(t,e,15,16776960,.8);o.setDepth(5),this.scene.tweens.add({targets:o,scaleX:2,scaleY:2,alpha:0,duration:200,ease:"Power2",onComplete:function(){o.destroy()}});for(var n=function(o){var n=i.scene.add.circle(t,e,3,16746496,.9),r=2*Math.PI*o/6;i.scene.tweens.add({targets:n,x:t+30*Math.cos(r),y:e+30*Math.sin(r),alpha:0,duration:300,ease:"Power2",onComplete:function(){n.destroy()}})},i=this,r=0;r<6;r++)n(r)},e}(r.System);e.CollisionSystem=y},754:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.System=void 0;var o=function(){function t(t){this.enabled=!0,this.world=t,console.log("[System] 创建系统: ".concat(this.constructor.name))}return t.prototype.getEntitiesWith=function(){for(var t,e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];return(t=this.world).getEntitiesWith.apply(t,e)},t.prototype.getEntityWith=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=this.getEntitiesWith.apply(this,t);return o.length>0?o[0]:void 0},t.prototype.destroy=function(){console.log("[System] 销毁系统: ".concat(this.constructor.name))},t.prototype.getName=function(){return this.constructor.name},t.prototype.getPriority=function(){return 0},t.prototype.setEnabled=function(t){console.log("[System] ".concat(this.constructor.name," 设置启用状态: ").concat(t)),this.enabled=t},t.prototype.isEnabled=function(){return this.enabled},t}();e.System=o},774:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),o(227);var n=o(636),i=o(919),r={type:Phaser.AUTO,parent:"game",width:800,height:600,backgroundColor:"#000000",scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1,fps:60}},scene:[n.MainScene,i.GameOverScene],audio:{disableWebAudio:!1},render:{pixelArt:!1,antialias:!0,roundPixels:!0,powerPreference:"high-performance"},input:{keyboard:!0,mouse:!0,touch:!0,gamepad:!1},fps:{target:60,forceSetTimeOut:!0,deltaHistory:10}};e.default=r},863:function(t,e,o){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),o(227);var i=n(o(774));window.addEventListener("load",(function(){var t=new Phaser.Game(i.default);console.log("%c游戏日志系统初始化 (ECS版本)","color: #4CAF50; font-weight: bold"),console.log("%c["+(new Date).toLocaleTimeString()+"] [System] ECS 游戏初始化","color: #666666"),t.events.on("ready",(function(){console.log("%c["+(new Date).toLocaleTimeString()+"] [System] ECS 游戏引擎就绪","color: #666666")})),t.events.on("boot",(function(){console.log("%c["+(new Date).toLocaleTimeString()+"] [System] ECS 游戏启动","color: #666666")})),t.events.once("destroy",(function(){console.log("%c["+(new Date).toLocaleTimeString()+"] [System] ECS 游戏销毁","color: #666666")})),window.addEventListener("resize",(function(){t.scale.refresh()})),document.addEventListener("visibilitychange",(function(){var e;document.hidden?(e=t.scene.getScenes(!0)[0])&&t.scene.pause(e):(e=t.scene.getScenes(!0)[0])&&t.scene.resume(e)})),console.log("%c["+(new Date).toLocaleTimeString()+"] [System] ECS 游戏启动完成","color: #666666"),console.log("%c ECS 游戏页面加载完成","color: #4CAF50; font-weight: bold")}))},870:function(t,e,o){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0}),e.HealthBarSystem=void 0;var r=o(754),s=o(526),a=o(531),c=o(159),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.update=function(t){for(var e=0,o=this.getEntitiesWith(s.HealthBarComponent,a.HealthComponent,c.TransformComponent);e<o.length;e++){var n=o[e],i=n.getComponent(s.HealthBarComponent),r=n.getComponent(a.HealthComponent),l=n.getComponent(c.TransformComponent);i.bar||i.createHealthBar(l.x,l.y),i.updateHealthBar(l.x,l.y,r.currentHealth,r.maxHealth)}},e}(r.System);e.HealthBarSystem=l},903:function(t,e,o){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0}),e.EnemyComponent=void 0;var r=function(t){function e(e,o,n,i,r,s,a){void 0===e&&(e=100),void 0===o&&(o=25),void 0===n&&(n=40),void 0===i&&(i=1e3),void 0===r&&(r=100),void 0===s&&(s=.2),void 0===a&&(a=2);var c=t.call(this)||this;return c.lastAttackTime=0,c.isKnockbackActive=!1,c.bounceIntensity=.2,c.bounceFrequency=2,c.bounceTime=0,c.baseScale=1,c.currentScale=1,c.bounceEnabled=!0,c.isMoving=!1,c.movementSpeed=e,c.damage=o,c.attackRange=n,c.attackCooldown=i,c.maxHealthPerBar=r,c.bounceIntensity=s,c.bounceFrequency=a,c.bounceTime=Math.random()*Math.PI*2,c}return i(e,t),e.prototype.canAttack=function(t){return t-this.lastAttackTime>=this.attackCooldown},e.prototype.attack=function(t){this.lastAttackTime=t},e.prototype.setKnockback=function(t){this.isKnockbackActive=t},e.prototype.updateBounceAnimation=function(t){if(this.bounceEnabled)if(this.bounceTime+=t/1e3*this.bounceFrequency,this.isMoving&&!this.isKnockbackActive){var e=(1+Math.cos(this.bounceTime))/2*this.bounceIntensity,o=this.baseScale-e;this.currentScale=Phaser.Math.Linear(this.currentScale,o,.15)}else this.currentScale=Phaser.Math.Linear(this.currentScale,this.baseScale,.08);else this.currentScale=this.baseScale},e.prototype.getCurrentScale=function(){return this.currentScale},e.prototype.setMoving=function(t){this.isMoving=t},e.prototype.setBounceParameters=function(t,e){this.bounceIntensity=Math.max(0,Math.min(1,t)),this.bounceFrequency=Math.max(.1,e)},e.prototype.setBounceEnabled=function(t){this.bounceEnabled=t,t||(this.currentScale=this.baseScale)},e}(o(264).Component);e.EnemyComponent=r},919:function(t,e,o){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0}),e.GameOverScene=void 0,o(227);var r=function(t){function e(){var e=t.call(this,{key:"GameOverScene"})||this;return e.score=0,e.wave=0,e}return i(e,t),e.prototype.init=function(t){this.score=t.score||0,this.wave=t.wave||0},e.prototype.create=function(){var t,e=this,o=this.cameras.main.centerX,n=this.cameras.main.centerY;this.add.rectangle(o,n,this.cameras.main.width,this.cameras.main.height,0,.8),this.add.text(o,n-150,"游戏结束",{fontSize:"48px",color:"#ff0000",fontStyle:"bold"}).setOrigin(.5),this.add.text(o,n-80,"最终得分: ".concat(this.score),{fontSize:"32px",color:"#ffffff"}).setOrigin(.5),this.add.text(o,n-40,"到达波数: ".concat(this.wave),{fontSize:"24px",color:"#ffffff"}).setOrigin(.5),this.add.text(o,n+40,"重新开始",{fontSize:"24px",color:"#ffffff",backgroundColor:"#333333",padding:{x:20,y:10}}).setOrigin(.5).setInteractive().on("pointerdown",(function(){e.scene.start("MainScene")})),this.add.text(o,n+120,'点击"重新开始"或按任意键重新游戏',{fontSize:"16px",color:"#cccccc"}).setOrigin(.5),null===(t=this.input.keyboard)||void 0===t||t.once("keydown",(function(){e.scene.start("MainScene")})),this.input.once("pointerdown",(function(){e.scene.start("MainScene")})),console.log("游戏结束场景创建完成 - 得分: ".concat(this.score,", 波数: ").concat(this.wave))},e}(Phaser.Scene);e.GameOverScene=r},966:function(t,e,o){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0}),e.MovementSystem=void 0;var r=o(754),s=o(159),a=o(88),c=o(570),l=o(707),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.BOUNDS={minX:20,maxX:780,minY:20,maxY:580},e}return i(e,t),e.prototype.update=function(t){for(var e=0,o=this.getEntitiesWith(s.TransformComponent,a.VelocityComponent);e<o.length;e++){var n=o[e],i=n.getComponent(s.TransformComponent),r=n.getComponent(a.VelocityComponent),p=n.getComponent(c.SpriteComponent),h=n.getComponent(l.ProjectileComponent);r.applyFriction(t);var u=t/1e3,y=i.x+r.vx*u,m=i.y+r.vy*u;h?(i.x=y,i.y=m):(i.x=Math.max(this.BOUNDS.minX,Math.min(this.BOUNDS.maxX,y)),i.y=Math.max(this.BOUNDS.minY,Math.min(this.BOUNDS.maxY,m)),(y<this.BOUNDS.minX||y>this.BOUNDS.maxX)&&(r.vx=0),(m<this.BOUNDS.minY||m>this.BOUNDS.maxY)&&(r.vy=0)),p&&(p.sprite.setPosition(i.x,i.y),p.sprite.setVelocity(r.vx,r.vy))}},e}(r.System);e.MovementSystem=p}},t=>{t.O(0,[96],(()=>t(t.s=529))),t.O()}]);